<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{ViewSanPham/layout/head :: head}"></head>

<body class="hold-transition skin-blue sidebar-mini">
<style>
    h4 {
        font-size: 18px;
        font-weight: bold;
        color: #3c8dbc;
    }

    canvas {
        background: #fefefe;
        border-radius: 8px;
    }
    #pieChart {
        width: 400px;
        margin: auto;
        height:400px;
    }
</style>

<div class="wrapper">

    <header th:replace="~{ViewSanPham/layout/header :: header}"></header>
    <aside th:replace="~{ViewSanPham/layout/aside :: aside}"></aside>

    <div class="content-wrapper">
        <section class="content-header">
            <h1>
                Trang Quản Trị Admin Bán Áo Phông
                <small>Thống Kê & Báo Cáo</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li class="active">Dashboard</li>
            </ol>
        </section>

        <section class="content">
            <div class="box box-primary">
                <div class="box-header with-border clearfix">
                    <h3 class="box-title pull-left" style="padding-top: 7px;"> Thống Kê & Báo Cáo</h3>
                </div>

                <div class="box-body">
                    <form method="get" class="form-inline" style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label for="fromDate">Từ ngày:</label>
                            <input type="date" id="fromDate" name="fromDate" class="form-control"
                                   th:value="${fromDate}" style="margin-left: 10px; margin-right: 30px;">
                        </div>
                        <div class="form-group">
                            <label for="toDate">Đến ngày:</label>
                            <input type="date" id="toDate" name="toDate" class="form-control"
                                   th:value="${toDate}" style="margin-left: 10px; margin-right: 30px;">
                        </div>
                        <button type="submit" class="btn btn-primary">Lọc</button>
                    </form>

                    <div class="row">
                        <!-- Tổng doanh thu -->
                        <div class="col-lg-4 col-12">
                            <div class="small-box bg-success">
                                <div class="inner">
                                    <h3 th:text="${tongDoanhThu != null ? #numbers.formatDecimal(tongDoanhThu, 0, 'COMMA', 0, 'POINT') + ' VNĐ' : '0 VNĐ'}">
                                        0 VNĐ
                                    </h3>
                                    <p>Tổng Doanh Thu</p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-cash"></i>
                                </div>
                                <a th:href="@{/hoa-don/hien-thi}" class="small-box-footer">
                                    Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Số hóa đơn -->
                        <div class="col-lg-4 col-12">
                            <div class="small-box bg-info">
                                <div class="inner">
                                    <h3 th:text="${soHoaDon}">0</h3>
                                    <p>Số Hóa Đơn</p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-bag"></i>
                                </div>
                                <a th:href="@{/admin/hoa-don}" class="small-box-footer">
                                    Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Số lượng sản phẩm bán ra -->
                        <div class="col-lg-4 col-12">
                            <div class="small-box bg-warning">
                                <div class="inner">
                                    <h3 th:text="${soLuongSanPham}">0</h3>
                                    <p>Sản Phẩm Bán Ra</p>
                                </div>
                                <div class="icon">
                                    <i class="ion ion-stats-bars"></i>
                                </div>
                                <a th:href="@{/admin/san-pham}" class="small-box-footer">
                                    Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>


                    <h4>Top sản phẩm bán chạy</h4>
                    <table class="table table-bordered table-hover table-condensed">
                        <thead style="background-color: #3c8dbc; color: white;">
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Số lượng bán</th>
                            <th>Thành tiền (VNĐ)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="sp : ${topSanPham}">
                            <td th:text="${sp[0]}">Tên sản phẩm</td>
                            <td th:text="${sp[1]}">Số lượng</td>
                            <td th:text="${#numbers.formatDecimal(sp[2], 0, 'COMMA', 0, 'POINT')} + ' ₫'">Thành tiền</td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- Hai biểu đồ cạnh nhau trong card UI -->
                    <div class="row">
                        <!-- Biểu đồ cột -->
                        <div class="col-lg-6">
                            <div class="card card-success">
                                <div class="card-header">
                                    <h3 class="card-title">Doanh thu theo ngày </h3>
                                </div>
                                <div class="card-body">
                                    <canvas id="barChart" style="min-height: 250px; height: 250px; max-width: 100%;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Biểu đồ tròn -->
                        <div class="col-lg-6">
                            <div class="card card-danger">
                                <div class="card-header">
                                    <h3 class="card-title">Tỷ lệ doanh thu theo sản phẩm</h3>
                                </div>
                                <div class="card-body">
                                    <canvas id="pieChart" ></canvas>

                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </section>
    </div>

    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Phiên bản</b> 1.0.0
        </div>
        <strong>&copy; 2025 <a href="#">Trendora</a>.</strong> Hệ thống quản trị bán áo phông. Thiết kế và phát triển bởi nhóm IT Trendora.
    </footer>

</div>



<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    // Dữ liệu từ controller
    let labels = /*[[${ngayList}]]*/ [];
    let data = /*[[${doanhThuList}]]*/ [];

    const ctxBar = document.getElementById('barChart').getContext('2d');
    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Doanh thu (VNĐ)',
                data: data,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
                borderRadius: 6 // bo góc cho cột nhìn mềm hơn
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: ctx => 'Doanh thu: ' + ctx.parsed.y.toLocaleString('vi-VN') + ' ₫'
                    },
                    backgroundColor: '#333',
                    titleFont: { weight: 'bold' },
                    bodyFont: { size: 14 }
                },
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    ticks: {
                        callback: value => value.toLocaleString('vi-VN') + ' ₫'
                    },
                    grid: {
                        color: '#eee'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });

    // Dữ liệu biểu đồ tròn
    let topSanPham = /*[[${topSanPham}]]*/ [];
    let pieLabels = topSanPham.map(sp => sp[0]);
    let pieData = topSanPham.map(sp => sp[2]);

    // Tạo dải màu gradient đẹp
    const pieColors = [
        '#36A2EB', '#FF6384', '#FFCE56',
        '#4BC0C0', '#9966FF', '#FF9F40',
        '#66FF66', '#FF6666', '#6699FF', '#CCCC00'
    ];

    // Biểu đồ tròn - Tỷ lệ doanh thu theo sản phẩm
    new Chart(document.getElementById('pieChart'), {
        type: 'doughnut',
        data: {
            labels: pieLabels,
            datasets: [{
                data: pieData,
                backgroundColor: pieColors.slice(0, pieLabels.length),
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 14,
                        padding: 15,
                        font: { size: 13 }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: ctx => ctx.label + ': ' + ctx.parsed.toLocaleString('vi-VN') + ' ₫'
                    }
                },
                title: {
                    display: false
                }
            }
        }
    });
</script>


<!-- Các thư viện JS cần thiết -->
<script th:src="@{/assets/bower_components/jquery/dist/jquery.min.js}"></script>
<script th:src="@{/assets/bower_components/bootstrap/dist/js/bootstrap.min.js}"></script>
<script th:src="@{/assets/dist/js/adminlte.min.js}"></script>

</body>
</html>
