<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
    <head th:replace="~{ViewSanPham/layout/head :: head}"></head>

    <header th:replace="~{ViewSanPham/layout/header :: header}" ></header>
    <!-- Left side column. contains the logo and sidebar -->

    <aside th:replace="~{ViewSanPham/layout/aside :: aside}" ></aside>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <section class="content-header">
            <h1>
                Trang Quản Trị Admin Bán Áo Phông
                <small>Control panel</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li class="active">Dashboard</li>
            </ol>
        </section>
        <div class="col-xs-14">
            <div class="box">
                <!--thong báo-->
                <div class="container-fluid mt-2">
                    <div th:if="${success}"
                         class="alert alert-success alert-dismissible fade in"
                         role="alert"
                         style="margin:10px;">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <span th:text="${success}"></span>
                    </div>

                    <div th:if="${error}"
                         class="alert alert-danger alert-dismissible fade in"
                         role="alert"
                         style="margin:10px;">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <span th:text="${error}"></span>
                    </div>
                </div>

                <div class="box-header">
                    <h3 class="box-title">Danh sách hóa đơn</h3>

                    <div class="box-tools" style="margin-bottom: 10px;">
                        <form action="/hoa-don/hien-thi" method="get" class="form-inline">

                            <!-- Dropdown lọc trạng thái -->
                            <!-- Dropdown trạng thái -->
                            <select name="trangThaiDonHang" class="form-control"
                                    onchange="document.getElementById('filterForm').submit()">
                                <option value="" th:selected="${trangThaiDonHang == null}">Tất cả</option>
                                <option value="CHO_XAC_NHAN" th:selected="${trangThaiDonHang?.name() == 'CHO_XAC_NHAN'}">Chờ xác nhận</option>
                                <option value="DA_XAC_NHAN" th:selected="${trangThaiDonHang?.name() == 'DA_XAC_NHAN'}">Đã xác nhận</option>
                                <option value="DANG_DONG_GOI" th:selected="${trangThaiDonHang?.name() == 'DANG_DONG_GOI'}">Đang đóng gói</option>
                                <option value="DANG_VAN_CHUYEN" th:selected="${trangThaiDonHang?.name() == 'DANG_VAN_CHUYEN'}">Đang vận chuyển</option>
                                <option value="DA_GIAO" th:selected="${trangThaiDonHang?.name() == 'DA_GIAO'}">Đã giao</option>
                                <option value="DA_HOAN_THANH" th:selected="${trangThaiDonHang?.name() == 'DA_HOAN_THANH'}">Đã hoàn thành</option>
                                <option value="DA_HUY" th:selected="${trangThaiDonHang?.name() == 'DA_HUY'}">Đã hủy</option>
                            </select>


                            <!-- Ô tìm kiếm -->
                            <input type="text" id="tenKhachHang" name="tenKhachHang" class="form-control"
                                   placeholder="Tìm theo tên khách hàng..." th:value="${tenKhachHang}">

                            <!-- Nút Tìm kiếm -->
                            <button type="submit" class="btn btn-primary btn-sm" style="margin-left: 5px;">
                                <i class="fa fa-search"></i> Tìm
                            </button>

                            <!-- Nút Reset -->
                            <a href="/hoa-don/hien-thi" class="btn btn-default btn-sm" style="margin-left: 5px;">
                                <i class="fa fa-refresh"></i> Reset
                            </a>

                        </form>
                    </div>
                </div>


                <div class="row" style="margin: 20px 0 30px 0;">
                    <!-- Tổng hóa đơn -->
                    <div class="col-md-3 col-sm-6 col-xs-12" style="padding: 0 10px;">
                        <div class="info-box" style="background-color: #00c0ef; border-radius: 8px; padding: 20px; text-align: center; color: white;">
                            <i class="fa fa-file-text-o" style="font-size: 30px; margin-bottom: 10px;"></i>
                            <span class="info-box-text" style="font-weight: bold; font-size: 16px;">Tổng hóa đơn</span>
                            <span class="info-box-number" th:text="${tongHoaDon}" style="font-size: 22px;"></span>
                        </div>
                    </div>

                    <!-- Đã hoàn thành -->
                    <div class="col-md-3 col-sm-6 col-xs-12" style="padding: 0 10px;">
                        <div class="info-box" style="background-color: #00a65a; border-radius: 8px; padding: 20px; text-align: center; color: white;">
                            <i class="fa fa-check-circle" style="font-size: 30px; margin-bottom: 10px;"></i>
                            <span class="info-box-text" style="font-weight: bold; font-size: 16px;">Đã hoàn thành</span>
                            <span class="info-box-number" th:text="${daHoanThanh}" style="font-size: 22px;"></span>
                        </div>
                    </div>

                    <!-- Đã hủy -->
                    <div class="col-md-3 col-sm-6 col-xs-12" style="padding: 0 10px;">
                        <div class="info-box" style="background-color: #f39c12; border-radius: 8px; padding: 20px; text-align: center; color: white;">
                            <i class="fa fa-times-circle" style="font-size: 30px; margin-bottom: 10px;"></i>
                            <span class="info-box-text" style="font-weight: bold; font-size: 16px;">Đã hủy</span>
                            <span class="info-box-number" th:text="${daHuy}" style="font-size: 22px;"></span>
                        </div>
                    </div>

                    <!-- Tổng doanh thu -->
                    <div class="col-md-3 col-sm-6 col-xs-12" style="padding: 0 10px;">
                        <div class="info-box" style="background-color: #00a7c0; border-radius: 8px; padding: 20px; text-align: center; color: white;">
                            <i class="fa fa-money" style="font-size: 30px; margin-bottom: 10px;"></i>
                            <span class="info-box-text" style="font-weight: bold; font-size: 16px;">Tổng doanh thu</span>
                            <span class="info-box-number"
                                  th:text="${#numbers.formatDecimal(tongDoanhThu, 0, 'COMMA', 0, 'POINT')} + ' đ'"
                                  style="font-size: 22px;"></span>
                        </div>
                    </div>
                </div>





                <div class="box-body table-responsive no-padding">

                            <!-- Bảng danh sách hóa đơn -->
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAll"> </th>
                                    <th>STT</th>
                                    <th>Nhân viên</th>
                                    <th>Khách hàng</th>
                                    <th>Giảm giá</th>
                                    <th>Hình thức thanh toán</th>
                                    <th>Ngày tạo</th>
                                    <th>Địa Chỉ giao hàng</th>
                                    <th>Tổng tiền</th>
                                    <th>Trạng thái đơn hàng</th>
                                    <th>Trạng thái</th>
                                    <th>Hành động</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="hd, iterStat : ${list}">
                                    <td>
                                        <input type="checkbox" name="hoaDonIds" th:value="${hd.id}" class="rowCheckbox">
                                    </td>
                                    <td th:text="${currentPage * 6 + iterStat.index + 1}"></td>
                                    <td th:text="${hd.tenNhanVien}"></td>
                                    <td th:text="${hd.tenKhachHang}"></td>
                                    <td th:text="${hd.tenGiamGia}"></td>
                                    <td th:text="${hd.tenHinhThucThanhToan}"></td>
                                    <td th:text="${hd.ngayTao}"></td>
                                    <td th:text="${hd.diaChiGiaoHang}"></td>
                                    <td th:text="${hd.tongTien}"></td>
                                    <td th:text="${hd.trangThaiDonHang}"></td>
                                    <td th:text="${hd.trangThai == 1 ? 'Đã thanh toán' : (hd.trangThai == 2 ? 'Đã hủy' : 'Chưa thanh toán')}"></td>
                                    <td>
                                        <a th:href="@{'/hoa-don/update?id=' + ${hd.id}}"
                                           th:text="${hd.trangThai == 0 ? 'Đã thanh toán' : 'Chưa thanh toán'}"
                                           class="btn btn-warning btn-sm"
                                           onclick="return confirm('Cập nhật trạng thái thanh toán?');">Cập nhật</a>

                                        <th:block th:if="${hd.trangThaiDonHang.name() == 'CHO_XAC_NHAN'
                                           or hd.trangThaiDonHang.name() == 'DA_XAC_NHAN'
                                           or hd.trangThaiDonHang.name() == 'DANG_DONG_GOI'}">

                                            <!-- Nút mở modal -->
                                            <button type="button" class="btn btn-danger btn-sm"
                                                    data-toggle="modal"
                                                    th:data-target="'#huyModal-' + ${hd.id}">
                                                Hủy đơn
                                            </button>

                                            <!-- Modal nhập lý do -->
                                            <div class="modal fade" th:id="'huyModal-' + ${hd.id}" tabindex="-1" role="dialog">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <form th:action="@{'/hoa-don/huy/' + ${hd.id}}" method="post">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title">Hủy đơn hàng</h5>
                                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                            </div>

                                                            <div class="modal-body">
                                                                <label>Lý do hủy:</label>
                                                                <textarea class="form-control" name="lyDoHuy" required></textarea>
                                                            </div>

                                                            <div class="modal-footer">
                                                                <button type="submit" class="btn btn-danger">Xác nhận hủy</button>
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </th:block>


                                        <a th:href="@{'/hoa-don/detail?id=' + ${hd.id}}" class="btn btn-primary btn-sm">Chi tiết</a>
                                        <a th:href="@{'/hoa-don/in?id=' + ${hd.id} + '&redirect=hoa-don/hien-thi'}"
                                           class="btn btn-success btn-sm">In lại hóa đơn</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>



                    <script>
                        const selectAll = document.getElementById("selectAll");
                        const checkboxes = document.querySelectorAll(".rowCheckbox");
                        const panel = document.getElementById("bulkActionPanel");

                        selectAll.addEventListener("change", function () {
                            checkboxes.forEach(cb => cb.checked = this.checked);
                            panel.style.display = this.checked ? "block" : "none";
                        });

                        checkboxes.forEach(cb => {
                            cb.addEventListener("change", function () {
                                const anyChecked = [...checkboxes].some(c => c.checked);
                                panel.style.display = anyChecked ? "block" : "none";
                            });
                        });
                    </script>



                    <!-- Thông báo thành công -->
                    <!--                    <table class="table table-hover">-->
                    <!--                        <tbody>-->
                    <!--                        <tr>-->
                    <!--                            <th>STT</th>-->
                    <!--                            <th>Nhân viên</th>-->
                    <!--                            <th>Khách hàng</th>-->
                    <!--                            <th>Giảm giá</th>-->
                    <!--                            <th>Hình thức thanh toán</th>-->
                    <!--&lt;!&ndash;                            <th>Mã hóa đơn</th>&ndash;&gt;-->
                    <!--                            <th>Ngày tạo</th>-->
                    <!--                            <th>Địa Chỉ giao hàng</th>-->
                    <!--                            <th>Tổng tiền</th>-->
                    <!--                            <th>Trạng thái đơn hàng</th>-->
                    <!--                            <th>Trạng thái</th>-->
                    <!--                            <th>Hành động</th>-->
                    <!--                        </tr>-->
                    <!--                        <th:block th:each="hd, iterStat : ${list}">-->
                    <!--                            <tr>-->
                    <!--                                <td th:text="${currentPage * 6 + iterStat.index + 1}"></td>-->
                    <!--                                <td th:text="${hd.tenNhanVien}"></td>-->
                    <!--                                <td th:text="${hd.tenKhachHang}"></td>-->
                    <!--                                <td th:text="${hd.tenGiamGia}"></td>-->
                    <!--                                <td th:text="${hd.tenHinhThucThanhToan}"></td>-->
                    <!--&lt;!&ndash;                                <td th:text="${hd.maHd}"></td>&ndash;&gt;-->
                    <!--                                <td th:text="${hd.ngayTao}"></td>-->
                    <!--                                <td th:text="${hd.diaChiGiaoHang}"></td>-->
                    <!--                                <td th:text="${hd.tongTien}"></td>-->
                    <!--                                <td th:text="${hd.trangThaiDonHang}"></td>-->
                    <!--                                <td th:text="${hd.trangThai == 1 ? 'Đã thanh toán' : (hd.trangThai == 2 ? 'Đã hủy' : 'Chưa thanh toán')}"></td>-->
                    <!--                                <td>-->
                    <!--                                    <a th:href="@{'/hoa-don/update?id=' + ${hd.id}}"-->
                    <!--                                       th:text="${hd.trangThai == 0 ? 'Đã thanh toán' : 'Chưa thanh toán'}"-->
                    <!--                                       class="btn btn-warning btn-sm"-->
                    <!--                                       onclick="return confirm('Cập nhật trạng thái thanh toán?');">Cập nhật-->
                    <!--                                    </a>-->

                    <!--                                    <th:block th:if="${hd.trangThaiDonHang.name() == 'CHO_XAC_NHAN'}">-->
                    <!--                                        <a th:href="@{'/hoa-don/huy?id=' + ${hd.id}}" class="btn btn-danger btn-sm"-->
                    <!--                                           onclick="return confirm('Bạn có chắc muốn hủy đơn hàng này không?');">-->
                    <!--                                            Hủy đơn-->
                    <!--                                        </a>-->
                    <!--                                    </th:block>-->

                    <!--                                    <a th:href="@{'/hoa-don/detail?id=' + ${hd.id}}" class="btn btn-primary btn-sm">Chi tiết</a>-->

                    <!--                                    <a th:href="@{'/hoa-don/in?id=' + ${hd.id} + '&redirect=hoa-don/hien-thi'}"-->
                    <!--                                       class="btn btn-success btn-sm">-->
                    <!--                                        In lại hóa đơn-->
                    <!--                                    </a>-->


                    <!--                                    &lt;!&ndash;                                    <a th:href="@{'/hoa-don/in?id=' + ${hd.id}}"&ndash;&gt;-->
                    <!--                                    &lt;!&ndash;                                       class="btn btn-success btn-sm"&ndash;&gt;-->
                    <!--                                    &lt;!&ndash;                                       target="_blank">&ndash;&gt;-->
                    <!--                                    &lt;!&ndash;                                        In lại hóa đơn&ndash;&gt;-->
                    <!--                                    &lt;!&ndash;                                    </a>&ndash;&gt;-->

                    <!--                                </td>-->
                    <!--                            </tr>-->
                    <!--                        </th:block>-->
                    <!--                        </tbody>-->
                    <!--                    </table>-->
                    <!-- Phân trang -->
                    <div class="box-footer clearfix">
                        <ul class="pagination pagination-sm no-margin pull-right">

                            <!-- Nút Previous -->
                            <li th:classappend="${currentPage == 0}? 'disabled'">
                                <a th:if="${currentPage > 0}"
                                   th:href="@{/hoa-don/hien-thi(page=${currentPage-1}, maHd=${search})}">&laquo;</a>
                                <span th:if="${currentPage == 0}">&laquo;</span>
                            </li>

                            <!-- Các trang -->
                            <li th:each="i : ${#numbers.sequence(0, totalPages-1)}"
                                th:classappend="${i == currentPage}? 'active'">
                                <a th:href="@{/hoa-don/hien-thi(page=${i}, maHd=${search})}"
                                   th:text="${i+1}"></a>
                            </li>

                            <!-- Nút Next -->
                            <li th:classappend="${currentPage + 1 == totalPages}? 'disabled'">
                                <a th:if="${currentPage + 1 < totalPages}"
                                   th:href="@{/hoa-don/hien-thi(page=${currentPage+1}, maHd=${search})}">&raquo;</a>
                                <span th:if="${currentPage + 1 == totalPages}">&raquo;</span>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>

        </div>
    </div>
    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 2.4.13
        </div>
        <strong>Copyright &copy; 2014-2019 <a href="https://adminlte.io/">AdminLTE</a>.</strong> All rights
        reserved.
    </footer>
</div>
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
<script th:src="@{/assets/bower_components/jquery/dist/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/bower_components/jquery-ui/jquery-ui.min.js}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/assets/bower_components/bootstrap/dist/js/bootstrap.min.js}"></script>
<!-- Morris.js charts -->
<script th:src="@{/assets/bower_components/raphael/raphael.min.js}"></script>
<script th:src="@{/assets/bower_components/morris.js/morris.min.js}"></script>
<!-- Sparkline -->
<script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script th:src="@{/assets/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js}"></script>
<script th:src="@{/assets/plugins/jvectormap/jquery-jvectormap-world-mill-en.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/assets/bower_components/jquery-knob/dist/jquery.knob.min.js}"></script>
<!-- daterangepicker -->
<script th:src="@{/assets/bower_components/moment/min/moment.min.js}"></script>
<script th:src="@{/assets/bower_components/bootstrap-daterangepicker/daterangepicker.js}"></script>
<!-- datepicker -->
<script th:src="@{/assets/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js}"></script>
<!-- Bootstrap WYSIHTML5 -->
<script th:src="@{/assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js}"></script>
<!-- Slimscroll -->
<script th:src="@{/assets/bower_components/jquery-slimscroll/jquery.slimscroll.min.js}"></script>
<!-- FastClick -->
<script th:src="@{/assets/bower_components/fastclick/lib/fastclick.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/assets/dist/js/adminlte.min.js}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script th:src="@{/assets/dist/js/pages/dashboard.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/assets/dist/js/demo.js}"></script>
<script th:src="@{/assets/ad.js}"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"941d2071ef3dfd9f","version":"2025.4.0-1-g37f21b1","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"2437d112162f4ec4b63c3ca0eb38fb20","b":1}' crossorigin="anonymous"></script>
</body>
</html>