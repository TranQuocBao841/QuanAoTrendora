<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<style>
    input[type="radio"][disabled] {
        opacity: 1 !important;
        pointer-events: none; /* Kh√¥ng cho t∆∞∆°ng t√°c */
    }

    input[type="radio"][disabled] + label {
        opacity: 1 !important;
        color: #000 !important;
        cursor: default;
        pointer-events: none;
    }
</style>
<!-- Mirrored from adminlte.io/themes/AdminLTE/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 May 2025 17:35:24 GMT -->
<body class="hold-transition skin-blue sidebar-mini">
<!-- Bootstrap 3.3.7 CDN (chu·∫©n cho AdminLTE 2) -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<div class="wrapper">

    <head th:replace="~{ViewSanPham/layout/head :: head}"></head>

    <header th:replace="~{ViewSanPham/layout/header :: header}" ></header>
    <!-- Left side column. contains the logo and sidebar -->

    <aside th:replace="~{ViewSanPham/layout/aside :: aside}" ></aside>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Trang Qu·∫£n Tr·ªã Admin B√°n √Åo Ph√¥ng
                <small>B√°n h√†ng T·∫°i Qu·∫ßy</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li class="active">T·∫°i Qu·∫ßy</li>
            </ol>
        </section>

        <!-- Main content -->

        <div class="container-fluid">
            <h3 class="text-primary"><i class="glyphicon glyphicon-shopping-cart"></i> B√°n h√†ng t·∫°i qu·∫ßy</h3>

            <!-- T√¨m ki·∫øm v√† l·ªçc -->
            <div class="form-inline mb-3">
                <input type="text" class="form-control mr-2" id="searchSanPham" placeholder="T√¨m t√™n s·∫£n ph·∫©m...">

                <select id="filterDanhMuc" class="form-control mr-2">
                    <option value="">-- Danh m·ª•c --</option>
                    <option th:each="dm : ${danhMucs}" name="tendanhMuc" th:value="${dm.id}" th:text="${dm.tendanhMuc}"></option>
                </select>

                <select id="filterMauSac" class="form-control mr-2">
                    <option value="">-- M√†u s·∫Øc --</option>
                    <option th:each="m : ${listMau}" name="tenmauSac" th:value="${m.id}" th:text="${m.tenmauSac}"></option>
                </select>

                <select id="filterKichThuoc" class="form-control mr-2">
                    <option value="">-- K√≠ch th∆∞·ªõc --</option>
                    <option th:each="kt : ${listSize}"  name="tenkichThuoc"  th:value="${kt.id}" th:text="${kt.tenkichThuoc}"></option>
                </select>
            </div>

            <form method="post" th:action="@{/ban-hang/thanh-toan}" oninput="tinhTongTien()" id="formThanhToan">
                <div class="row">

                    <!-- DANH S√ÅCH S·∫¢N PH·∫®M -->
                    <div class="col-md-8">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h4 class="box-title">Danh s√°ch s·∫£n ph·∫©m</h4>
                            </div>
                            <div class="box-body table-responsive no-padding" style=" overflow-y: auto;">
                                <table class="table" id="productTable">
                                    <thead>
                                    <tr>
                                        <th>·∫¢nh</th>
                                        <th>T√™n s·∫£n ph·∫©m</th>
                                        <th>Gi√°</th>
                                        <th>S·ªë l∆∞·ª£ng</th>
                                        <th>#</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="sp : ${danhSachSanPham}"
                                        th:attr="data-ten=${sp.tenSanPham},
                                         data-danhmuc=${sp.danhMuc.id},
                                         data-mau=${sp.mauSac.id},
                                         data-size=${sp.kichThuoc.id}">
                                        <td><img th:src="@{${sp.anhSanPham}}" width="50px" /></td>
                                        <td>
                                            <span th:text="${sp.tenSanPham}"></span><br>
                                            <button type="button" class="btn btn-xs btn-info"
                                                    th:attr="onclick=|xemChiTietSanPham('${sp.id}', '${sp.tenSanPham}', '${sp.maSanPham}', '${sp.gia}', '${sp.moTa}', '${sp.coAo.tencoAo}' , '${sp.khuyAo.tenkhuyAo}', '${sp.kieuDang.tenkieuDang}', '${sp.duongMay.tenduongMay}', '${sp.hoaTiet.tenhoaTiet}', '${sp.phongCach.tenphongCach}' , '${sp.chatLieu.tencl}' , '${sp.mauSac.tenmauSac}', '${sp.kichThuoc.tenkichThuoc}', '${sp.danhMuc.tendanhMuc}' , '${sp.tayAo.tentayAo}', '${sp.anhSanPham}')|">
                                                <i class="glyphicon glyphicon-eye-open"></i> Xem
                                            </button>
                                        </td>
                                        <td><span th:text="${#numbers.formatDecimal(sp.gia, 0, 'COMMA', 0, 'POINT')}"></span> ‚Ç´</td>
                                        <td>
                                            <span th:text="${sp.soLuong}"></span>
                                        </td>
                                        <td>
                                        <td>
                                            <button type="button" class="btn btn-success btn-sm"
                                                    th:attr="onclick=|themVaoGioHang('${sp.id}', '${sp.tenSanPham}', '${sp.kichThuoc.tenkichThuoc}', '${sp.gia}', '${sp.soLuong}')|">
                                                <i class="glyphicon glyphicon-plus"></i> Th√™m
                                            </button>
                                        </td>

                                        </td>
                                    </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>

                    <!-- FORM THANH TO√ÅN B√äN PH·∫¢I -->
                    <div class="col-md-4">
                        <div class="box box-success">
                            <div class="box-header with-border">
                                <h4 class="box-title">Th√¥ng tin thanh to√°n</h4>
                            </div>
                            <div class="box-body">

                                <!-- KH√ÅCH H√ÄNG -->
                                <div class="form-group">
                                    <label>Kh√°ch h√†ng:</label>
                                    <div class="input-group">
                                        <input type="text" id="tenKhachHang" readonly placeholder="Ch∆∞a ch·ªçn kh√°ch h√†ng" class="form-control">
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-primary" onclick="openKhachHangModal()">
                                                <i class="glyphicon glyphicon-user"></i>
                                            </button>
                                        </span>
                                    </div>
                                    <input type="hidden" name="khachHang" id="idKhachHang">
                                </div>

                                <!-- GI·ªé H√ÄNG B√äN PH·∫¢I -->
                                <div class="form-group" id="gioHangSection" style="display: none;">
                                    <label><i class="glyphicon glyphicon-list-alt"></i> S·∫£n ph·∫©m ƒë√£ ch·ªçn:</label>
                                    <div class="table-responsive" style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd;">
                                        <table class="table table-bordered table-condensed" style="margin-bottom: 0;">
                                            <thead>
                                            <tr class="bg-info">
                                                <th>T√™n</th>
                                                <th>Size</th>
                                                <th>S·ªë l∆∞·ª£ng</th>
                                                <th>ƒê∆°n gi√°</th>
                                                <th>Th√†nh ti·ªÅn</th>
                                                <th>X√≥a</th>
                                            </tr>
                                            </thead>
                                            <tbody id="gioHangBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <hr>
                                <!-- GI·∫¢M GI√Å -->
                                <div class="form-group">
                                    <label>Ch·ªçn phi·∫øu gi·∫£m gi√°:</label>
                                    <select name="giamGiaId" class="form-control" id="giamGiaSelect" onchange="apDungGiamGia()">
                                        <option value="">-- Kh√¥ng √°p d·ª•ng --</option>
                                        <option th:each="gg : ${phieuGiamGias}"
                                                th:value="${gg.id}"
                                                th:data-loai="${gg.loaiGiamGia}"
                                                th:data-gia-tri="${gg.giaTriGiam}"
                                                th:text="${gg.tenGiamGia + ' (' + gg.giaTriGiam + (gg.loaiGiamGia == 'PERCENT' ? '%' : '‚Ç´') + ')'}">
                                        </option>
                                    </select>
                                </div>
                                <!-- H√åNH TH·ª®C THANH TO√ÅN -->
                                <div class="form-group">
                                    <label>H√¨nh th·ª©c thanh to√°n:</label>
                                    <select name="hinhThuc" class="form-control" required onchange="xuLyHinhThucThanhToan(this.value)">
                                        <option value="">-- Ch·ªçn h√¨nh th·ª©c --</option>
                                        <option th:each="ht : ${hinhThucs}" th:value="${ht.id}" th:text="${ht.tenHinhThuc}"></option>
                                    </select>
                                </div>

                                <!-- TH√îNG TIN TI·ªÄN -->
                                <div class="form-group row">
                                    <label class="col-xs-6">T·ªïng ti·ªÅn h√†ng:</label>
                                    <div class="col-xs-6 text-right text-primary">
                                        <b><span id="tong-tien-goc">0</span> ‚Ç´</b>
                                    </div>
                                </div>


                                <div class="form-group row">
                                    <label class="col-xs-6">Gi·∫£m gi√°:</label>
                                    <div class="col-xs-6 text-right text-success">
                                        <b><span id="muc-giam">0</span> ‚Ç´</b>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-xs-6"><strong>T·ªïng thanh to√°n:</strong></label>
                                    <div class="col-xs-6 text-right text-danger">
                                        <b><span id="tong-tien">0</span> ‚Ç´</b>
                                    </div>
                                </div>
                                <input type="hidden" name="tongTien" id="tongTienHidden" value="0">

                                <!-- QR THANH TO√ÅN -->
                                <div class="form-group" id="qrThanhToanContainer" style="display: none;">
                                    <label>M√£ QR chuy·ªÉn kho·∫£n (MB Bank):</label>
                                    <div class="text-center">
                                        <img id="qrCodeImg" src="" alt="QR Code MB Bank" style="max-width: 300px; margin-top: 20px;">
                                        <p><small>Ng∆∞·ªùi nh·∫≠n: Nguy·ªÖn Th·ªã H√† Lan (MB Bank ‚Äì STK: 0912713606)</small></p>
                                    </div>
                                </div>

                                <div id="tienMatFields" style="display: none;">
                                    <!-- TI·ªÄN KH√ÅCH ƒê∆ØA -->
                                    <div class="form-group">
                                        <label>Ti·ªÅn kh√°ch ƒë∆∞a:</label>
                                        <input type="number" class="form-control" id="tienKhachDua" name="tienKhachDua" min="0" oninput="tinhTienThua()">
                                    </div>

                                    <!-- TI·ªÄN TR·∫¢ L·∫†I -->
                                    <div class="form-group">
                                        <label>Ti·ªÅn tr·∫£ l·∫°i kh√°ch:</label>
                                        <input type="text" class="form-control" id="tienThua" readonly>
                                    </div>
                                </div>


                                <!-- N√öT THANH TO√ÅN -->
                                <button type="submit" class="btn btn-success btn-block">
                                    <i class="glyphicon glyphicon-ok"></i> Thanh to√°n
                                </button>

                            </div>
                        </div>
                    </div>

                </div>
            </form>
        </div>

        <div class="modal fade" id="khachHangModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Danh s√°ch kh√°ch h√†ng</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th>T√™n</th>
                                <th>SƒêT</th>
                                <th>ƒê·ªãa ch·ªâ</th>
                                <th>Email</th>
                                <th>Ng√†y sinh</th>
                                <th>Ch·ªçn</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="kh : ${khachHangs}">
                                <td th:text="${kh.tenKh}"></td>
                                <td th:text="${kh.sdt}"></td>
                                <td th:text="${kh.diaChi}"></td>
                                <td th:text="${kh.email}"></td>
                                <td th:text="${kh.ngaySinh}"></td>
                                <td>
                                    <button type="button" class="btn btn-success btn-sm"
                                            th:attr="onclick=|chonKhachHang('${kh.idKh}', '${kh.tenKh}')|">
                                        <i class="glyphicon glyphicon-ok"></i>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" data-dismiss="modal">ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Modal Chi ti·∫øt s·∫£n ph·∫©m -->
        <div class="modal fade" id="modalChiTietSanPham" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content box box-primary">
                    <div class="modal-header with-border">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title"><i class="fa fa-info-circle text-blue"></i> Chi ti·∫øt s·∫£n ph·∫©m</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <!-- ·∫¢nh b√™n tr√°i -->
                            <div class="col-sm-5 text-center">
                                <img id="chiTietAnh" src="" class="img-responsive img-thumbnail" style="max-height:300px;" alt="·∫¢nh s·∫£n ph·∫©m">
                            </div>

                            <!-- Th√¥ng tin b√™n ph·∫£i -->
                            <div class="col-sm-7">
                                <h4 id="chiTietTen" class="text-primary text-bold"></h4>
                                <p><strong>M√£ s·∫£n ph·∫©m:</strong> <span id="chiTietMa"></span></p>
                                <p><strong>Gi√°:</strong> <span id="chiTietGia"></span> ‚Ç´</p>
                                <p><strong>M√¥ t·∫£:</strong> <span id="chiTietMoTa"></span></p>
                                <hr style="margin: 10px 0;">

                                <div class="row">
                                    <div class="col-xs-6">
                                        <p><strong>M√†u s·∫Øc:</strong> <span id="chiTietMauSac"></span></p>
                                        <p><strong>K√≠ch th∆∞·ªõc:</strong> <span id="chiTietKichThuoc"></span></p>
                                        <p><strong>Ch·∫•t li·ªáu:</strong> <span id="chiTietChatLieu"></span></p>
                                        <p><strong>Phong c√°ch:</strong> <span id="chiTietPhongCach"></span></p>
                                        <p><strong>Tay √°o:</strong> <span id="chiTietTayAo"></span></p>
                                    </div>
                                    <div class="col-xs-6">
                                        <p><strong>C·ªï √°o:</strong> <span id="chiTietCoAo"></span></p>
                                        <p><strong>Khuy √°o:</strong> <span id="chiTietKhuyAo"></span></p>
                                        <p><strong>Ki·ªÉu d√°ng:</strong> <span id="chiTietKieuDang"></span></p>
                                        <p><strong>ƒê∆∞·ªùng may:</strong> <span id="chiTietDuongMay"></span></p>
                                        <p><strong>H·ªça ti·∫øt:</strong> <span id="chiTietHoaTiet"></span></p>
                                        <p><strong>Danh m·ª•c:</strong> <span id="chiTietDanhMuc"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default pull-right" data-dismiss="modal"><i class="fa fa-times"></i> ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        </div>





        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 2.4.13
        </div>
        <strong>Copyright &copy; 2014-2019 <a href="https://adminlte.io/">AdminLTE</a>.</strong> All rights
        reserved.
    </footer>
</div>

<script>
    const input = document.getElementById('imageURLInput');
    const preview = document.getElementById('imagePreview');

    input.addEventListener('input', () => {
        const url = input.value;
        if (url) {
            preview.src = url;
            preview.style.display = 'block';
        } else {
            preview.src = '';
            preview.style.display = 'none';
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const selectHinhThuc = document.querySelector('select[name="hinhThuc"]');
        const qrContainer = document.getElementById('qrThanhToanContainer');
        const qrImg = document.getElementById('qrCodeImg');
        const tongTienInput = document.getElementById('tongTienHidden');
        const tienMatFields = document.getElementById('tienMatFields');
        const inputTienKhachDua = document.getElementById("tienKhachDua");

        // X·ª≠ l√Ω khi thay ƒë·ªïi h√¨nh th·ª©c thanh to√°n
        selectHinhThuc.addEventListener('change', function () {
            const selectedText = selectHinhThuc.options[selectHinhThuc.selectedIndex].text.toLowerCase();
            const tongTien = tongTienInput.value;

            // Hi·ªÉn th·ªã QR n·∫øu l√† chuy·ªÉn kho·∫£n ho·∫∑c v√≠ ƒëi·ªán t·ª≠
            if (selectedText.includes('chuy·ªÉn kho·∫£n') || selectedText.includes('v√≠ ƒëi·ªán t·ª≠')) {
                qrContainer.style.display = 'block';
                tienMatFields.style.display = 'none';

                const qrUrl = `https://img.vietqr.io/image/MB-0912713606-compact.png?amount=${tongTien}&addInfo=Thanh%20toan%20tai%20quay&accountName=NGUYEN%20THI%20HA%20LAN`;
                qrImg.src = qrUrl;

            } else if (selectedText.includes('ti·ªÅn m·∫∑t')) {
                qrContainer.style.display = 'none';
                qrImg.src = '';
                tienMatFields.style.display = 'block';
            } else {
                // Tr∆∞·ªùng h·ª£p kh√°c (ch∆∞a ch·ªçn ho·∫∑c kh√¥ng x√°c ƒë·ªãnh)
                qrContainer.style.display = 'none';
                qrImg.src = '';
                tienMatFields.style.display = 'none';
            }
        });

        // G√µ Enter ·ªü √¥ ti·ªÅn kh√°ch ƒë∆∞a ƒë·ªÉ t√≠nh ti·ªÅn th·ª´a
        inputTienKhachDua.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
                e.preventDefault();
                tinhTienThua();
            }
        });
    });
</script>

<!-- JavaScript x·ª≠ l√Ω -->


<script>
    function tinhTongTien() {
        let tong = 0;
        const rows = document.querySelectorAll("tbody tr");

        rows.forEach(row => {
            const input = row.querySelector("input.so-luong");
            if (!input) return;
            const donGia = parseInt(input.getAttribute("data-gia")) || 0;
            const soLuong = parseInt(input.value) || 0;
            const thanhTien = donGia * soLuong;
            const cell = row.querySelector(".thanh-tien");
            if (cell) cell.innerText = thanhTien.toLocaleString();
            tong += thanhTien;
        });

        // üëâ Ch·ªâ g√°n t·ªïng ti·ªÅn g·ªëc v√†o input ƒë·ªÉ g·ª≠i l√™n server
        document.getElementById("tongTienHidden").value = tong;

        // üëâ C·∫≠p nh·∫≠t hi·ªÉn th·ªã ph√≠a ng∆∞·ªùi d√πng (kh√¥ng thay ƒë·ªïi input ·∫©n)
        document.getElementById("tong-tien-goc").innerText = tong.toLocaleString();

        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã gi·∫£m gi√° (n·∫øu c·∫ßn)
        hienThiGiamGia(tong);
    }

    function hienThiGiamGia(tongGoc) {
        const select = document.getElementById("giamGiaSelect");
        const selected = select.options[select.selectedIndex];
        let giamGia = 0;

        if (selected && selected.value !== "") {
            const loai = selected.getAttribute("data-loai");
            const giaTri = parseInt(selected.getAttribute("data-gia-tri")) || 0;

            if (loai === "PERCENT") {
                giamGia = Math.floor(tongGoc * giaTri / 100);
            } else {
                giamGia = giaTri;
            }

            if (giamGia > tongGoc) giamGia = tongGoc;
        }

        // üëâ Ch·ªâ hi·ªÉn th·ªã m·ª©c gi·∫£m, KH√îNG g√°n l·∫°i tongTienHidden
        document.getElementById("muc-giam").innerText = giamGia.toLocaleString();
        document.getElementById("tong-tien").innerText = (tongGoc - giamGia).toLocaleString();

        // C√≥ th·ªÉ th√™m n·∫øu b·∫°n mu·ªën hi·ªán QR:
        capNhatQR(tongGoc - giamGia);
    }

    function capNhatQR(tongTienSauGiam) {
        const selectHinhThuc = document.querySelector('select[name="hinhThuc"]');
        const qrContainer = document.getElementById('qrThanhToanContainer');
        const qrImg = document.getElementById('qrCodeImg');
        const selectedOption = selectHinhThuc.options[selectHinhThuc.selectedIndex].text.toLowerCase();

        if (selectedOption.includes('chuy·ªÉn kho·∫£n') || selectedOption.includes('v√≠ ƒëi·ªán t·ª≠')) {
            qrContainer.style.display = 'block';
            const qrUrl = `https://img.vietqr.io/image/MB-0912713606-compact.png?amount=${tongTienSauGiam}&addInfo=Thanh%20toan%20tai%20quay&accountName=NGUYEN%20THI%20HA%20LAN`;
            qrImg.src = qrUrl;
        } else {
            qrContainer.style.display = 'none';
            qrImg.src = '';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        tinhTongTien(); // T√≠nh l·∫°i khi trang load
    });

</script>

<script>
    function tinhTienThua() {
        var tienKhach = parseFloat(document.getElementById("tienKhachDua").value) || 0;
        var tongThanhToanText = document.getElementById("tong-tien").innerText.replace(/[^\d]/g, '') || "0";
        var tongThanhToan = parseFloat(tongThanhToanText);

        if (!isNaN(tienKhach) && !isNaN(tongThanhToan)) {
            var tienThua = tienKhach - tongThanhToan;
            document.getElementById("tienThua").value = tienThua >= 0
                ? tienThua.toLocaleString() + " ƒë"
                : "Thi·∫øu " + Math.abs(tienThua).toLocaleString() + " ƒë";
        } else {
            document.getElementById("tienThua").value = "";
        }
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        taiKhachHangDaChon();
        ganSuKienLoc();
    });

    function ganSuKienLoc() {
        ['#searchSanPham', '#filterDanhMuc', '#filterMauSac', '#filterKichThuoc'].forEach(selector => {
            const input = document.querySelector(selector);
            if (input) {
                input.addEventListener('input', () => {
                    locSanPham();
                    taiKhachHangDaChon(); // ƒê·∫£m b·∫£o g√°n l·∫°i th√¥ng tin kh√°ch sau l·ªçc
                });
            }
        });
    }

    function locSanPham() {
        const keyword = document.getElementById('searchSanPham').value.toLowerCase();
        const danhMuc = document.getElementById('filterDanhMuc').value;
        const mau = document.getElementById('filterMauSac').value;
        const size = document.getElementById('filterKichThuoc').value;

        document.querySelectorAll('#productTable tbody tr').forEach(row => {
            const ten = row.getAttribute('data-ten')?.toLowerCase() || '';
            const dm = row.getAttribute('data-danhmuc') || '';
            const ms = row.getAttribute('data-mau') || '';
            const kt = row.getAttribute('data-size') || '';

            const match =
                (!keyword || ten.includes(keyword)) &&
                (!danhMuc || dm === danhMuc) &&
                (!mau || ms === mau) &&
                (!size || kt === size);

            row.style.display = match ? '' : 'none';
        });
    }

    function chonKhachHang(id, ten) {
        document.getElementById("tenKhachHang").value = ten;
        document.getElementById("idKhachHang").value = id;
        localStorage.setItem("khachHangDaChon", JSON.stringify({ id, ten }));
        $('#khachHangModal').modal('hide');
    }

    function taiKhachHangDaChon() {
        const kh = JSON.parse(localStorage.getItem("khachHangDaChon"));
        if (kh) {
            document.getElementById("tenKhachHang").value = kh.ten;
            document.getElementById("idKhachHang").value = kh.id;
        }
    }

    function openKhachHangModal() {
        $('#khachHangModal').modal('show');
    }
</script>






<script>
    function xemChiTietSanPham(id, ten, ma, gia, moTa, coAo, khuyAo, kieuDang, duongMay, hoaTiet, phongCach, chatLieu, mauSac, kichThuoc, danhMuc, tayAo, anh) {
        document.getElementById("chiTietTen").innerText = ten;
        document.getElementById("chiTietMa").innerText = ma;
        document.getElementById("chiTietGia").innerText = parseInt(gia).toLocaleString();
        document.getElementById("chiTietMoTa").innerText = moTa;

        document.getElementById("chiTietCoAo").innerText = coAo;
        document.getElementById("chiTietKhuyAo").innerText = khuyAo;
        document.getElementById("chiTietKieuDang").innerText = kieuDang;
        document.getElementById("chiTietDuongMay").innerText = duongMay;
        document.getElementById("chiTietHoaTiet").innerText = hoaTiet;
        document.getElementById("chiTietPhongCach").innerText = phongCach;
        document.getElementById("chiTietChatLieu").innerText = chatLieu;
        document.getElementById("chiTietMauSac").innerText = mauSac;
        document.getElementById("chiTietKichThuoc").innerText = kichThuoc;
        document.getElementById("chiTietDanhMuc").innerText = danhMuc;
        document.getElementById("chiTietTayAo").innerText = tayAo;

        // ‚úÖ G√°n ƒë∆∞·ªùng d·∫´n ·∫£nh (anh ƒë√£ l√† /uploads/abc.jpg ho·∫∑c URL ƒë·∫ßy ƒë·ªß)
        document.getElementById("chiTietAnh").src = anh;

        // ‚úÖ Hi·ªÉn th·ªã modal theo ki·ªÉu Bootstrap 3
        $('#modalChiTietSanPham').modal('show');
    }
</script>
<script>
    let gioHang = [];

    function themVaoGioHang(id, ten, size, gia, tonKho) {
        gia = parseFloat(gia);
        tonKho = parseInt(tonKho);

        const itemIndex = gioHang.findIndex(sp => sp.id === id && sp.size === size);

        if (itemIndex !== -1) {
            if (gioHang[itemIndex].soLuong < tonKho) {
                gioHang[itemIndex].soLuong++;
                alert("‚úÖ ƒê√£ tƒÉng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè h√†ng.");
            } else {
                alert("‚ö†Ô∏è S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho!");
            }
        } else {
            gioHang.push({ id, ten, size, gia, soLuong: 1, tonKho });
            alert("‚úÖ Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng th√†nh c√¥ng!");
        }

        capNhatBangGioHang();
        tinhTongTien();
    }
    function capNhatBangGioHang() {
        const tbody = document.getElementById("gioHangBody");
        const section = document.getElementById("gioHangSection");
        const form = document.getElementById("formThanhToan");

        // X√≥a to√†n b·ªô input c≈© c·ªßa gi·ªè h√†ng trong form
        document.querySelectorAll(".input-gio-hang").forEach(e => e.remove());

        tbody.innerHTML = "";

        if (gioHang.length === 0) {
            section.style.display = "none";
            return;
        } else {
            section.style.display = "block";
        }

        gioHang.forEach((sp, index) => {
            const thanhTien = sp.gia * sp.soLuong;

            const row = `
            <tr>
                <td>${sp.ten}</td>
                <td>${sp.size}</td>
                <td>
                    <input type="number" class="form-control input-sm so-luong"
                        value="${sp.soLuong}" min="1" max="${sp.tonKho}"
                        data-gia="${sp.gia}" onchange="capNhatSoLuong(${index}, this)">
                </td>
                <td>${sp.gia.toLocaleString()} ‚Ç´</td>
                <td class="thanh-tien">${thanhTien.toLocaleString()} ‚Ç´</td>
                <td>
                    <button class="btn btn-danger btn-xs" onclick="xoaKhoiGioHang(${index})">
                        <i class="glyphicon glyphicon-trash"></i>
                    </button>
                </td>
            </tr>
        `;
            tbody.insertAdjacentHTML("beforeend", row);

            // ‚úÖ Th√™m input ·∫©n v√†o form ƒë·ªÉ g·ª≠i v·ªÅ Controller
            const inputHidden = document.createElement("input");
            inputHidden.type = "hidden";
            inputHidden.name = `sp_${sp.id}`;
            inputHidden.value = sp.soLuong;
            inputHidden.classList.add("input-gio-hang");
            form.appendChild(inputHidden);
        });
    }

    function capNhatSoLuong(index, input) {
        const newQty = parseInt(input.value);
        const max = parseInt(input.max);
        if (newQty > max) {
            alert("‚ö†Ô∏è V∆∞·ª£t qu√° s·ªë l∆∞·ª£ng t·ªìn kho!");
            input.value = gioHang[index].soLuong;
            return;
        }
        gioHang[index].soLuong = newQty;
        capNhatBangGioHang();
        tinhTongTien();
    }

    function xoaKhoiGioHang(index) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh·ªèi gi·ªè h√†ng?")) {
            gioHang.splice(index, 1);
            capNhatBangGioHang();
            tinhTongTien();
        }
    }

</script>
<script>
    function openGioHangModal() {
        $('#gioHangModal').modal('show');
    }
</script>

<!-- Trong JS, th√™m check disable sau submit -->
<script>
    document.querySelector("form").addEventListener("submit", function () {
        this.querySelector("button[type=submit]").disabled = true;
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const idKhachHang = document.getElementById("idKhachHang");
        const tenKhachHang = document.getElementById("tenKhachHang");

        // N·∫øu ch∆∞a c√≥ kh√°ch h√†ng n√†o ƒë∆∞·ª£c ch·ªçn, g√°n m·∫∑c ƒë·ªãnh l√† "Kh√°ch l·∫ª"
        if (!idKhachHang.value || idKhachHang.value.trim() === "") {
            idKhachHang.value = 9; // ID kh√°ch l·∫ª
            tenKhachHang.value = "Kh√°ch l·∫ª"; // T√™n hi·ªÉn th·ªã
        }
    });
</script>



<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



<!-- jQuery 3 -->
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
<script th:src="@{/assets/bower_components/jquery/dist/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/bower_components/jquery-ui/jquery-ui.min.js}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/assets/bower_components/bootstrap/dist/js/bootstrap.min.js}"></script>
<!-- Morris.js charts -->
<script th:src="@{/assets/bower_components/raphael/raphael.min.js}"></script>
<script th:src="@{/assets/bower_components/morris.js/morris.min.js}"></script>
<!-- Sparkline -->
<script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script th:src="@{/assets/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js}"></script>
<script th:src="@{/assets/plugins/jvectormap/jquery-jvectormap-world-mill-en.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/assets/bower_components/jquery-knob/dist/jquery.knob.min.js}"></script>
<!-- daterangepicker -->
<script th:src="@{/assets/bower_components/moment/min/moment.min.js}"></script>
<script th:src="@{/assets/bower_components/bootstrap-daterangepicker/daterangepicker.js}"></script>
<!-- datepicker -->
<script th:src="@{/assets/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js}"></script>
<!-- Bootstrap WYSIHTML5 -->
<script th:src="@{/assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js}"></script>
<!-- Slimscroll -->
<script th:src="@{/assets/bower_components/jquery-slimscroll/jquery.slimscroll.min.js}"></script>
<!-- FastClick -->
<script th:src="@{/assets/bower_components/fastclick/lib/fastclick.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/assets/dist/js/adminlte.min.js}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script th:src="@{/assets/dist/js/pages/dashboard.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/assets/dist/js/demo.js}"></script>
<script th:src="@{/assets/ad.js}"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"941d2071ef3dfd9f","version":"2025.4.0-1-g37f21b1","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"2437d112162f4ec4b63c3ca0eb38fb20","b":1}' crossorigin="anonymous"></script>
</body>

<!-- Mirrored from adminlte.io/themes/AdminLTE/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 May 2025 17:35:27 GMT -->
</html>
